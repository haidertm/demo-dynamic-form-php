<?php

// Include Composer's autoload file
require_once __DIR__ . '/../vendor/autoload.php';

use Haider\Demo\Api\Router;
use Haider\Demo\Core\Classes\Database;
use Haider\Demo\Api\Controllers\GreetingsController;

// Create a Database object
$db = new Database();

// Get the URL parameter
$url = isset($_GET['url']) ? $_GET['url'] : '';

// Split the URL into parts
$parts = explode('/', $url);

// Determine the controller and method based on the URL
$controllerName = 'GreetingsController';
$methodName = 'sayHello';

if (!empty($parts[0])) {
    $controllerName = ucfirst($parts[0]) . 'Controller';
    if (!empty($parts[1])) {
        $methodName = $parts[1];
    }
}

// Check if the controller class exists
$controllerClass = 'Haider\\Demo\\Api\\Controllers\\' . $controllerName;
if (class_exists($controllerClass)) {
    // Create an instance of the controller
    $controller = new $controllerClass($db);

    // Check if the method exists in the controller
    if (method_exists($controller, $methodName)) {
        // Call the method
        $controller->$methodName();
    } else {
        echo json_encode(["status" => "method_not_found"]);
    }
} else {
    echo json_encode(["status" => "controller_not_found"]);
}
